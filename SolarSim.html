<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar System Simulation</title>
  <style>
    body {
      flex-direction: row-reverse; /* Controls on RH of screen */
      display: flex;
      height: 100vh;
      margin: 0;
      background-color: black;
      color: white;
      font-family: "Courier New", monospace;
    }

    #controls {
      width: 25%;
      padding: 1em;
      background-color: #111;
      border-right: 1px solid #333;
    }

    #controls h2 {
      margin-top: 0;
    }

    /* Control group styles */
    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .control-group label {
      width: 70px;
      text-align: right;
    }

    .control-btn {
      width: 70px;
      padding: 4px;
    }

    #display {
      flex-grow: 1;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>

  <div id="controls">
    <h2>Simulation Controls</h2>

    <div class="control-group">
      <label for="timeSlider">Speed:</label>
      <input type="range" id="timeSlider" min="0" max="100" step="1" value="50" />
      <input type="text" id="speedDisplay" value="50" size="4" />
      <button id="resetSpeedBtn" class="control-btn">Reset</button>
    </div>

    <div class="control-group">
      <label for="zoomSlider">Zoom:</label>
      <input type="range" id="zoomSlider" min="0.5" max="3" step="0.1" value="1" />
      <input type="text" id="zoomDisplay" value="1" size="4" />
      <button id="resetZoomBtn" class="control-btn">Reset</button>
    </div>

    <div class="control-group">
      <!-- No label here needed -->
      <button id="pauseBtn" class="control-btn">Pause</button>
    </div>

  </div>

  <div id="display">
    <canvas id="starCanvas"></canvas>
    <canvas id="solarCanvas"></canvas>
  </div>

  <script>
    // ====== DOM & Canvases ======
    const starCanvas = document.getElementById('starCanvas');
    const solarCanvas = document.getElementById('solarCanvas');
    const starCtx = starCanvas.getContext('2d');
    const solarCtx = solarCanvas.getContext('2d');

    function resizeCanvases() {
      [starCanvas, solarCanvas].forEach(c => {
        c.width = c.clientWidth;
        c.height = c.clientHeight;
      });
    }
    window.addEventListener('resize', resizeCanvases);
    resizeCanvases();

    // ====== Controls ======
    const timeSlider = document.getElementById('timeSlider');
    const speedDisplay = document.getElementById('speedDisplay');
    const resetSpeedBtn = document.getElementById('resetSpeedBtn');

    const zoomSlider = document.getElementById('zoomSlider');
    const zoomDisplay = document.getElementById('zoomDisplay');
    const resetZoomBtn = document.getElementById('resetZoomBtn');

    const pauseBtn = document.getElementById('pauseBtn');
    let isPaused = false;
    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? "Play" : "Pause";
    });

    // Speed control
    const defaultSpeedValue = 50;
    timeSlider.addEventListener('input', () => { speedDisplay.value = timeSlider.value; });
    speedDisplay.addEventListener('input', () => { timeSlider.value = speedDisplay.value; });
    resetSpeedBtn.addEventListener('click', () => {
      timeSlider.value = defaultSpeedValue;
      speedDisplay.value = defaultSpeedValue;
    });

    // Zoom control
    let zoomFactor = 1;
    zoomSlider.addEventListener('input', () => { zoomFactor = parseFloat(zoomSlider.value); zoomDisplay.value = zoomFactor; });
    zoomDisplay.addEventListener('input', () => { zoomFactor = parseFloat(zoomDisplay.value); zoomSlider.value = zoomFactor; });
    resetZoomBtn.addEventListener('click', () => { zoomFactor = 1; zoomSlider.value = 1; zoomDisplay.value = 1; });

    // Optional: Scroll-to-zoom
    solarCanvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      zoomFactor = Math.min(3, Math.max(0.1, zoomFactor + e.deltaY * -0.001));
      zoomSlider.value = zoomFactor;
      zoomDisplay.value = zoomFactor;
    });

    // ====== Starfield (twinkle) ======
    const stars = [];
    const numStars = 200;
    function createStars() {
      stars.length = 0;
      for (let i = 0; i < numStars; i++) {
        stars.push({
          x: Math.random() * starCanvas.width,
          y: Math.random() * starCanvas.height,
          b: Math.random(),
          db: 0.005 + Math.random() * 0.02
          });
      }
    }

    function drawStars() {
      starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
      for (const s of stars) {
        s.b += s.db;
        if (s.b <= 0 || s.b >= 1) s.db = -s.db;
        const k = 200 + Math.floor(55 * s.b);
        starCtx.fillStyle = `rgb(${k},${k},${k})`;
        starCtx.fillRect(s.x, s.y, 2, 2);
      }
      requestAnimationFrame(drawStars);
    }

    createStars();
    drawStars();

    // ====== Physics: Sunâ€“Earth (AU, days) ======
    const DAYS_PER_YEAR = 365.25;
    const MU = (4 * Math.PI * Math.PI) / (DAYS_PER_YEAR * DAYS_PER_YEAR);  // AU^3/day^2

    let r = { x: 1.0, y: 0.0 };                      // AU
    //let v = { x: 0.0, y: (2 * Math.PI) / DAYS_PER_YEAR }; // AU/day
    const Velocity_Scale = 1;
    let v = { x: 0.0, y: (2 * Math.PI) / DAYS_PER_YEAR * Velocity_Scale };  // 50% slower

    function accel(r) {
      const rsq = r.x * r.x + r.y * r.y;
      const invR3 = 1 / (Math.sqrt(rsq) * rsq);
      return { x: -MU * r.x * invR3, y: -MU * r.y * invR3 };
    }

    const BASE_DT = 0.5; // days per frame at 1x speed

    function stepPhysics(dt) {
      const a0 = accel(r);
      const rNew = {
        x: r.x + v.x * dt + 0.5 * a0.x * dt * dt,
        y: r.y + v.y * dt + 0.5 * a0.y * dt * dt
      };
      const a1 = accel(rNew);
      v.x = v.x + 0.5 * (a0.x + a1.x) * dt;
      v.y = v.y + 0.5 * (a0.y + a1.y) * dt;
      r = rNew;
    }

    function drawSolarSystem() {
      solarCtx.clearRect(0, 0, solarCanvas.width, solarCanvas.height);
      const cx = solarCanvas.width / 2;
      const cy = solarCanvas.height / 2;
      const pxPerAUBase = Math.min(solarCanvas.width, solarCanvas.height) * 0.35;
      const pxPerAU = pxPerAUBase * zoomFactor;

      // Physics step
      const speedVal = parseFloat(timeSlider.value) || 0;
      if (!isPaused && speedVal > 0) {
        const mult = speedVal / 50;
        const dt = BASE_DT * mult;
        const substeps = Math.max(1, Math.floor(mult));
        const h = dt / substeps;
        for (let i = 0; i < substeps; i++) stepPhysics(h);
      }

      // Sun
      const sunR = 20 * zoomFactor;
      solarCtx.beginPath();
      solarCtx.arc(cx, cy, sunR, 0, Math.PI * 2);
      solarCtx.fillStyle = 'yellow';
      solarCtx.fill();

      // Orbit guide
      solarCtx.beginPath();
      solarCtx.arc(cx, cy, 1 * pxPerAU, 0, Math.PI * 2);
      solarCtx.strokeStyle = 'rgba(135,206,235,0.25)';
      solarCtx.lineWidth = 1;
      solarCtx.stroke();

      // Earth
      const ex = cx + r.x * pxPerAU;
      const ey = cy + r.y * pxPerAU;
      const earthR = 8 * zoomFactor;
      solarCtx.beginPath();
      solarCtx.arc(ex, ey, earthR, 0, Math.PI * 2);
      solarCtx.fillStyle = 'skyblue';
      solarCtx.fill();

      requestAnimationFrame(drawSolarSystem);
    }
    drawSolarSystem();
  </script>
</body>
</html>
